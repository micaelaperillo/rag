good afternoon cs109 how are you guys doing today fantastic that's what I like to hear oh we have another Wonderful class we get to learn about another incredible beautiful natural phenomena that's going to allow you to solve some interesting cool problems in the real world uh so we're both going to just see something beautiful and we're going to learn something useful which makes her a Wonderful class uh stay tuned and we will learn about poisson but not the fish kind the probability kind uh at the end of today's lecture we are going to pull some data from um the the herdat database which is the US database of uh all known hurricanes in the Atlantic and we'll try and answer questions about what's the probability of sort of extreme weather events that we may be seeing more of but before we get into that it is important that you know what we're building upon we are in this wonderful part of cs109 where we are learning about random variables and random variables are like a gift to you by previous mathematicians in random variable World a mathematician will come up with a narrative do a lot of math for that narrative package it all together into this wonderful package of a random variable and then if you recognize that narrative in a real world problem you can uh inherit all the mathematics that is given to you a random variable though at the end of the day is a very simple thing it's just a variable which takes on values probabilistically has semantic meaning we've been talking about discrete random variables and the most important thing for a discrete random variable is the relationship between the values it can take on and the probability of those values and we have talked about a couple summary statistics like expectation and then last class we talked about variance and standard deviation one of the most useful ones we've seen so far started with this Narrative of let's say we had n coin flips and every coin flip had a probability P of coming up heads could we package all the mathematics for talking about the probability of exactly K heads out of those end coin flips and we did that packaging of the math and then we realized that like oh my gosh this is so useful we could use it for any story where you have independent trials and you want to count the number of successes in those independent trials where they each have the same probability P of success we introduced our first classic random variable the binomial distribution and as soon as you see a story that fits that coin flip one you just say you know my random variable is not any random variable it's a super special one called a binomial random variable and you have to give the parameters n and p how many trials are there in your narrative and what's the probability of success in each triable trial and then you automatically inherit all of this for free you inherit the probability Mass function you don't have to derive this from scratch which is good because let's save you some time that probably Mass function can be expressed either as an equation or it can be expressed as a graph any way that you can really give the relationship between values and probabilities I take on fair game you could give somebody a function if you're a Sci-Fi stats we are going to start building up these cards of these classic random variables this is from the course reader so we now have the card for the binomial we have the card for the also a simpler one of Bernoulli it's like a binomial where you just have one coin flip Good Times if you know something as a binomial you don't just get the probably Mass function you also get equations for expectation and variance and that will be true for all the random variables that we direct we discover okay now this isn't reviewed that we've covered but it's just something that you we're going to use in today's class um which is this definition of the natural exponent uh and I'm just going to put this on the board and we're going to see if you can find a place in class when you can use it and you're wondering like wow that's a very beautiful limit I wonder who came up with it the same person who discovered the binomial wow what a time to be alive eat a lot of math just like us okay and that's what we have for review before we get into today's great topic okay I have a story for you I would like us to think about a scenario and the probability that underlies it and the scenario I'd like to think about is algorithmic ride sharing you know if you've ever gotten a shared lift ride for example there's a lot of probability that goes on under the hood to make a decision under uncertainty as who should go into which cards and it turns out there's this beautiful natural phenomena which is occurring underneath the hood that makes this math pretty reasonable to do so I want us to think about a scenario so I once lived here oh that was such a good time anyways let's say I clicked I want to have a shared ride the shared ride Service uh now has a probability question they have to decide you know what's the probability of getting K requests within this area in the next one minute and you know depending on that they might figure out how much they should charge me for my ride or they might make other decisions based off it but there's really this core understanding of how many people are going to ask for a ride in the same one minute you could tell me the average the expectation but that's not that useful for making decisions instead I want to know what's the probability of one request what's the probability of two requests what's the probability of three requests was it probably a four request I'd like to know the whole probability Mass function over the number of requests in one minute well you know let's just constrain this problem a bit let's just say we're just talking about within a small area of where I made my request and the interesting thing about these requests is that they'll be coming in over time so over one minute you know maybe one request comes 10 seconds later maybe one request comes 40 seconds later and these requests will be coming over this new dimension for us to think about and what an interesting and deeply fascinating Dimension it will become so we don't have mathematics for this yet but we can develop it based on what we do know so far now one final piece of information the only piece of information I have yet to give you is that your ride sharing app knows one piece of data they know on average how many requests come within one minute to this area it's not a lot of information to work on but it turns out if you understand this beautiful underlying phenomena in our natural world you can use a tiny amount of information and drive a whole bunch of meaning does that sound exciting or what shall we do this okay yeah now you don't have the tools for it yet but we learned about the binomial distribution in Wednesday's class and what we're going to do is we're going to hack that binomial distribution to come up with a hacky answer to the probability of number of requests within one minute here's my crazy hacky idea bear with me for a moment I'm going to take my minute which is continuous in all the beautiful complexity that time is continuous and I'm going to chop it into seconds and make it discreet I'm going to say my minute is actually 60 discrete seconds and I'm going to do something even happier I'm going to say every second I either get zero quests or one request you're like what if you get two requests I'm like no either zero requests or one request every single second and that's really hacky but once I've done this I've done this really crazy thing I've taken time and I've recast it as a story of flipping coins because now if I want to know how many requests I get in 60 seconds well I'm gonna flip a coin for every second if it's heads I get a request if it's Tails I don't get a request cool narrative right totally mind-bending what a weird thing to do but there is a problem this coin flipping story that we now have a little bit of practice with requires two numbers how many times do you flip your coin 60 I know that one feeling good and then you're like but what is the probability of success on every coin flip and you're like I don't know I'm like going on the edge of my seat I'm making this stuff up what is the probability of heads okay I'm trying this really hacky thing here can you guys help me out can you tell me what would be a reasonable choice for the probability of success if I did this hacky thing of took a minute broke it down to 60 seconds and thought about the number of requests as being coin flips the number of heads in 60 coin flips remember the one piece of information I've given you is that on average there's five requests per minute talk about with the person next to you let's see if we can crack this puzzle uh help me out on my hacky solution okay okay let's talk about to get I can't wait to talk about I know I just like you guys were just like having a nice calm day and you're like yeah binomial good times and I throw you the deep end we're like talking about time all of a sudden we're taking minutes and chopping them into seconds craziness before I even get into any answers somebody's got a question somebody's like what did you do like what's this coin Flip's doing in my my Uber pool Yeah question doesn't this assume that it takes one second to process a request like would your probability be different broke up the minute into a milliseconds or 10 seconds then you asked such a good question if I could just paraphrase a little bit you're like you chose 60 seconds wouldn't this be pretty different if you chose different amounts of time uh yeah those are pretty arbitrary decision for me to have made we're gonna explore the arbitrariness of that decision we'll try a couple different ways of breaking it up but for now I just thought 60 was pretty reasonable well let's talk about this in a moment though because we could have a good conversation you'd be like Chris it's not really reasonable uh and then but but first let's see where this gets us and then let's talk about what it's not really good for that is a very good question though why 60 I just chose it okay so I wanted to model this as coin flips crazy way to think about this problem but it requires me to say what's the probability of heads on every coin flip recall that in a binomial the coin flips always have the same probability of heads it's not always 0.5 it can be a different P it's just every coin flip has the same P probability of being heads that is one of the rules of the binomial so there is no perfect answer here but like what's your best guess for what P should be to make my world consistent one over twelve how did you get there five over 60. so I we need the expected value of coin flips via both parentheses to agree so you said five which conveniently is Lambda over 12 which is the same as sorry over 60. thank you which is the same I was using Lambda as my symbol for the average request per second and N is my number of coin flips okay so your claim is let's say we set P to be 5 over 60. now we're going to simulate requests by having some some poor person go and flip coins and they're going to flip 60 coins and it's a special coin that comes up heads only with a 5 or 60 probability so your claim is that if you flip 60 coins and they each have a 5 over 60 chance the binomial expectation says the expected expected value of a binomial is p so this number times n which is 60 which would be 5. hey that's nice and consistent if you choose this number your expected number of successes in 60 coin flips is going to be five great so this is wonderful we now have everything we can need to do to totally hack this problem we can solve this problem using a binomial distribution we're going to say every second you either get your request or you don't so we can define a random variable which is the number of requests in a minute and I'm going to call it x what a boring name man I miss programming where you can get the like descriptive names and in probability this is like X and Y but like whatever we'll live with it X is the number of requests in one minute and this crazy thing I've said is that now X is modeled as coin flips 60 coin flips the probability of heads on any one coin flip is 5 over 60 and we're going to count the number of heads once we've done this we inherit this formula and it's such a funny way of writing the relationship between assignments to X and a probability but that's what this is saying it's saying if you put in a zero for K it'll be telling you the probability that you get zero requests if you put one in for K it's telling you the probability that you get one coin flip which is our analogy for getting one request in a minute if you put in you know 60 for K it'll tell you the probability that you got six to your requests in your minute good business let's put in a concrete number let's put in a three if you put in a three we could substitute 16 for n number of coin flips three and four K that's our query and we can put 5 over 60 in for p that's the P that we chose to make this whole expectation work out and if you did this then you would be able to get an exact number for the probability of getting three requests within your minute great we've solved it we're done give us the next algorithmic challenge we're ready um but there is this wonderful question there's a lot of problems with this it feels arbitrary why did I choose 60. and I think there was this deep Insight in the question I was asked earlier is if you're flipping a coin it doesn't allow you for you to get two requests in the same second does it seem possible to get two requests in the same second yeah Bernal Heights is a popular place you can definitely get two requests in the same second so if this isn't that good is there a simple thing we could do to make it better everybody just yell out what would you do more divisions yeah we have the power of computers at our fingertips why stop at 60 when we could do sixty thousand I'm gonna do the exact same thought experiment but instead of doing 60 coin flips for my it's still one minute I'm gonna do 60 000 coin flips and every coin flip is representing whether I get a request within one millisecond uh now n is 60 what happens to P is it still 5 over 60 if it was 5 or 60 then you would be getting way more than five requests a minute and that's the one piece of historical data that we're working with uh what is the new P if we do ten thousand or sorry sixty thousand rather five over sixty thousand is that a bigger number or a smaller number okay small number yes uh so same problem we just have more more time frames and a lower probability of getting a success in time frames but we're still solving what's the probability of different numbers of requests within a minute there is a question question when when we break it up into such small parts I'm wondering if the binomial equation allows us in any way to change the probability over time like make a more frequent for life that it's such a good question it is the binomial is a beautiful thing it's near and dear to my heart it does so much for me but it doesn't change probabilities probabilities are constant so in the binomial it's always assuming that P is not changing if you make p change you would have to derive a new probability Mass function and it will be a more complicated one depending on how you're allowing your P to change it would be so nice if binomial did that and it does somebody we should appreciate it but it doesn't do that good good question okay so we need a constant P we're going to use this constant P okay once again the number of requests within my minute I'm going to use x and it's now still this process of flipping coin flips so it's like I got a Tails I got Tails I get the hills I got Tails I got heads that means I got a request at five milliseconds into my minute and you can continue this process and the number of heads is going to be our model for the number of requests and now we can say that X's model is a binomial and again it's a binomial but now n is 60 000 and P is going to be 5 divided by sixty thousand and again we can still ask the question what's the probability that X takes on a value say three and if you put three into this you'll actually get a very similar number but this will just be a little bit more accurate because the assumptions are better it's less likely that you get two requests within the same millisecond and for that reason this seems like just a straight Improvement but could we do better like what what's smaller than a millisecond an infinitely small sliver of time we're gonna go there are you guys ready to do this let's let's take a moment and get ready for a wonderful Adventure we are going to take the binomial to the Limit we're going to see what happens when we get smaller and smaller and smaller until we get infinitely small buckets uh we had a beautiful place of math for us to be are you guys ready I can't even draw them they're so small but we can still start to write out our binomial distribution so we could say I still care about the number requests it's still one minute even though we've gone into the infinity that is the amount of units of time within one minute X is going to be binomial but now there's infinite coin flips and every coin flip has a five over infinity probability of being hands whoa I know the we I'll tell you about the first person who did this he must have been feeling crazy he's like you know what I'm doing it I'm just gonna go to the edge today and so he did he thought what if you took this equation and you thought about it in the limit as n goes to Infinity notice I don't have a p I've already substituted in 5 over n and we're thinking about this not as 5 goes Infinity 5 will always be constant that's the thing that's one thing that stayed true in this crazy thought experiment is as n goes to Infinity the number of slices okay let's do this let's see something beautiful you guys want to see something beautiful let's jump into what happens when you take this binomial and take it into the limit oh where do you even start when you want to write out something like this what I do is I start by expanding at the beginning it's one of the many moves you can do and expanding in this case can look like take this term and expand it we've already looked earlier in class about what is the definition of this combinatorics sometimes we use that notation but it's short for this equation n choose K is n factorial divided by n minus K factorial times K factorial great and then see this term um 1 minus Lambda Over N to the power of n minus K as you know when you subtract exponents it's equivalent to if you had this raised to one exponent divided by this raised to another exponent so I've simplified this term earlier in class I wrote this beautiful equation on the board and it's going to be our first hint that something truly gorgeous is going to happen because one of these terms here as n goes to Infinity approaches this beautiful natural exponent to the power of negative Lambda does anyone see that term is it this one is it this one is it this one yeah yeah that whole term when n goes to Infinity that whole term is going to be a very nice e to the power of negative Lambda now my notation's got a little now limit as n goes to Infinity well there's not an N there so we're in a good place I also did I took this term on the base and I said it's one we're going into limits you know that's a wild place to be but my claim is as n goes to Infinity that whole denominator starts to look like a constant let's break it down as n goes to Infinity this starts to look like zero because five divided by Infinity is pretty small and then you have 1 minus zero and that starts to look like a one and one to raise to any power just looks like a one so this whole honking or expression has become something beautiful okay yay are we done is that where the beauty ends no we're just getting started okay I'm just gonna do a little bit of rearranging you know when you're looking at an equation like this you might think I want to get all like terms together in this case let's take everything that's got an n in it and let's move it to this side and we're going to reserve this for terms that don't have n in it and that's a convenient choice because we're thinking about the limit in terms of n so as n goes to Infinity this is not really going to be changing we have one last task to think about what does this mean as n goes to Infinity you have n factorial divided by n minus K factorial and then you also have this n to the power of K n factorial divided by n minus K factorial is maybe something worth thinking about and it's something that you'll see a lot in different derivations in probability let's put real numbers there if I gave you 7 factorial divided by 7 minus 3 factorial if you wrote this out this would be like seven six five four three two one and on the bottom you'd have 7 minus three is four so you have 4 3 2 1. and a bunch of these terms cancel out you know this cancels this cancels this cancels this cancels this cancels and you're just left with like this is basically saying for loop from seven decrementing by one each time until you get to this number and you're going to be multiplying those together so in our case what we've got going on is we have n factorial divided by n minus K factorial and that will look like n times n minus 1 times n minus 2 and remember K is kind of a small number it's like the three requests within the minute that we're going to be querying so let's say that you know just K is 3. so n times n minus 1 times n minus 2 times M minus 3 great um and that's covering this whole term n factorial divided by n minus K factorial we're still left with an N to the power of K I feel like I have an off by 1 here if you're subtracting off I went I left one more here than I should have if K was 3 you got to stop it too okay the only term left here that I haven't thought about is this n to the power of K and let's expand it n and n and this is in the case where k equals three or I'm just doing it for demonstration purposes so that we can reason about what happens as as n goes to Infinity if N is a n is like three these are pretty different numbers if n is 10 though this is like 10 10 10 and this is 10 9 8 and they start to look like a little bit some more similar numbers what if N is a hundred they start to look even more similar as n becomes Infinity this really starts to look like n times n times n divided by n times n times n now this is not a rigorous class on limits rather this is a class on probability so I want you to see this beauty and I want to give you guys the intuition for why this whole term here as n goes to Infinity this term goes to one and you're like wow and you're left with you know it's because this looks like one and you're left with this and you're like what's my next limit and you're like there's no more n's left in my equation I'm done and then you look at your equation and Tears start welling up in your eyes you're like it's so beautiful I've got that 5 to the power of my query the natural base to the power of the negative uh rate that was the five divide my query factorial and that's it we have taken the binomial in the limit and what seemed like a scary Endeavor led to such a beautiful simple equation and this beautiful simple equation carries so much power in it it means if something's following this process where we think you know events are coming independently over time all you need is to know Lambda and if somebody gives you Lambda you can infer all this structure over the probability of getting one request two requests three requests four requests and this is the powerful technology that people in ride sharing can use to make interesting decisions under uncertainty so maybe I'll pause here for a second because that was a wild ride yeah up here okay yes it is from this definition of the natural exponent so this is something that oh you look into the there's a cool Wikipedia page if you want to go deeper into why this is true but this is just one of the dilemmas that I came into class with yes because the differences between the numbers are arbitrarily small yes like K being a small number and N being something close to Infinity means that this really looks like n times n times n as n goes to Infinity like this minus two means nothing when it comes to Infinity okay good good question okay what a beautiful math proof the person who first did this math proof did it in uh the 17 in the 1800s and is but Simone denisong uh who was a French mathematician he published his first paper at 18. he became a professor when he was 21. he published over 300 papers in his lifetime this is hilarious quote he reportedly said life is good for only two things discovering mathematics and teaching mathematics and teaching mathematics is a fun thing Discovery mathematics is a fun thing but I don't know Sima I think there's a little bit more to life but I guess to each their own um and for a celebrity look alike I'm going with French Martin Freeman because he's a visit for mathematics he was the crazy individual who took the binomial to the limit for the first time the poisson random variable is named after him in the poisson random variable needs so little information as input it's amazing all you need to give to define a poisson random variable is you just need to give that five the average number of events within one time period and you could immediately know the probability of number of events within the time period so we often call that parameter that five the rate and we'll use Lambda for the rate what are the values that this random variable can take on when there is 60 seconds when we took our minute and broke into 60 seconds it could take on any value from 0 to 60. when we went up to 60 000 though we were thinking about this metaphor with 60 000 coin flips and technically a random variable could take on any value from the range zero to sixty thousand but when we took it to the Limit what does that leave us for possible values that X can take on yeah I can go really large it can go infinitely large so X could be a zero it could be one it could be two and it could be up to Infinity it's very unlikely to be Infinity uh but you know is defined over all those numbers it's a really interesting thing we're talking about time time is continuous but poisson is a discrete random variable it's talking about number of events you can't have half an event it's like somebody's like oh I kind of want to write that doesn't happen you either want the ride and you request it or you don't and if you define something to be a poisson you immediately inherit this gorgeous equation you immediately inherit the knowledge of how you can relate number of events with the probability of getting those number of events it's a magical thing okay there is a lot of things that fit this narrative this narrative is going to fit whenever something occurs over time and you want to know about the number of events within a fixed time window that's the narrative for a poisson there are some underlying assumptions for the poisson you know we were kind of flipping coins at an even rate so we're assuming that our events they're evenly distributed over your time segment lots of things follow this story like um you know number of earthquakes within one year radioactive decay within the next hour hits to a web server all these things are counting number events within a fixed period of time and you can immediately inherit all this mathematics you don't have to redefrive it every time you see a story like this the assumption is that events are arriving at a rate where there's Lambda events per interval of time and the assumption that this Lambda is somehow constant over your period is not changing too much how we got here is we did this crazy thought experiment where we took our time and split it into in the limit infinite sub intervals and we got the poisson now the reader we derived the poisson this is what a poisson looks like this is a poisson with rate of five so for those those ride sharing requests we said on average there's five requests per minute and with just the one piece of information all of this structure arises you tell me there's five requests per minute and I can tell you the probability of getting zero requests I can tell you probably have one request I can tell you the probability that you'll get 12 requests and I just needed one piece of information how wonderful is that there are other things that you can do with the poisson uh you can know the expectation and variance which we'll talk about in a second um but long story short poisson you just have a rate and it gives you a whole probability Mass function uh and really this is the major learning key if somebody asks you a question if they give you a rate so an average number of occurrences per time interval and they care about the probability of number occurrences that's your narrative that you're looking for the one tricky thing that I'm going to point out early is people will give you a rate within one-time interval and you have to make sure that the units for that rate match the units of your probability question so somebody says you know there's an average request per minute and they say what's the probability of number requests within one hour obviously you have to make those two match and you just multiply your request by minutes by 60. so from that one number how can you know that the poisson distribution is going to be an accurate representation of the entire probability this is a good question I mean as long as something follows the Bostonian process then that's all all the structure just comes because of the nature of limits in mathematics and so so the Assumption here is that I'm saying that requests over my minute are just as likely to come in in the first segment of the minute in the last segment of the minute that's a pretty reasonable request a reasonable assumption and then you have poisson and you could observe it you know like if they look at their logs they would see this in their historical data it has been shown time and time again it's such a crazy cool thing it's so crazy cool yeah it's saying on average there's five requests per minute but it's certainly saying it's possible to get two requests it's possible to get seven requests it's possible to get 18 requests is just very unlikely and so you just told me the average and I was able to expand from that average to all the queries you might want to know like the chance of eight or nine or ten so the poisson very much allows for more than five requests per time segment American video um if it's following the assumptions I said I will tell you exactly what the variance will be and you will be pleasantly surprised follow along because this wonderful journey is not over shall we go look into the variants now because we've looked at this probability Mass function we've created here uh about the beauty that we got just from knowing the rate and that's not where the story ends uh oh my gosh I did prepare to take us down that chapter but before we go into talking about variance can we hold that thought and can I just do a concrete example okay here is my concrete example real numbers uh this is from uh Earth major earthquakes uh within the Western Hemisphere so in the Western Hemisphere there's an average of 2.79 major earthquakes per year that's the only information I'm going to give you and now I'm going to ask you a probably question what's the probability of three major earthquakes next year are you allowed to give a rate that's not a whole number absolutely your average doesn't have to be a whole number your query must be a whole number because it doesn't make sense to ask what's the chance of getting 2.7 uh major earthquakes they're going to be a whole number of earthquakes we have all the information we need it's as simple as declare X to be the number of earthquakes next year recognize that it's a poisson because you're asking for a number of events with an interval of time you have to provide a rate when you declare a poisson you have to give that Lambda but we were told what it was 2.79 and when you say 2.79 poisson you immediately inherit this graph which says this is the chance of zero earthquakes one earthquake two earthquake three earthquakes of course this graph is represented by this beautiful equation and you could just plug into this beautiful equation what's the probability that x equals three so putting a 3 in for k a 2.79 in for Lambda and then reducing and you get that there's a 23 chance of having a major earthquake next year it's so beautiful it's natural to doubt it this can't be real there must be some a huge assumption there must be something wrong so somebody did this research somebody wrote the the paper which is is the sequence of earthquakes in Southern California with aftershocks removed poissonian and there's two interesting things about this paper they come to the conclusion that it is in fact Bostonian and it's also the paper in the world with the shortest abstract you guys want to see the abstract how bold is that they're just like yes done screw your reviewer too anyways you know you studied the actual distribution they're like in fact all of these predictions that we come from just doing pure math play out in the real world and that math that we just solved is in fact the true probability of getting three major earthquakes oh my gosh there's so many more cool things I have to tell you about poisson the next cool thing I have to tell you about poisson is in fact because of the nature of how we drive poisson recall that we got the poisson by taking the binomial and taking it into the limit it can also do this neat other trick which is sometimes you have a binomial distribution problem which has this n choose k foreign and that term can get so big that it can be hard to solve a binomial probability Mass function so a neat trick is because the poisson is defined by taking the binomial to a limit if your binomial problems become so big you can sometimes use a poisson to approximate a binomial if the binomial looks like it's going to the Limit you guys ready for this why would you do this well historically people didn't have super computers so this was a really big deal if you could approximate a binomial but there's two reasons one it could save you some compute power I'm not sure where that motivated by Saving compute power but the second one is I really want to build this intuition of where the poisson comes from and by recognizing the poisson as a process to approximate a binomial you'll get a deeper intuition for what the poisson is really about does that sound good okay let's do it I have another question for you I think this is such an interesting future that we might walk into all the movies images emails and other Digital Data from more than 600 smartphones could fit in this little pink drop if we figure out how to store data on DNA and it's looking like that's a possibility and for lots of reasons we might want to have data that persists more than what we're able to do with hard drives right now so let's play with this interesting scenario and let's think about the possibility of storing data on DNA and the interesting question for us to consider is what's the possibility of corruption so let's say we put all of our information onto DNA storage what's the probability that like less than one percent of it becomes corrupt in DNA but also if you're thinking about a real storage device you have a lot of things that you're restoring you have a very large string of data in this case we're going to imagine that we're going to put all of our information on a string of length 10 to the power of 4. so a pretty long string the probability of Corruption of any one base pair is rather small but we would like it for very few of our base pairs to become corrupted now this is a binomial if you want to talk about the number of base pairs that get corrupted it's like each letter in your string is a coin flip this is the chance that it comes up heads and we can talk about the number of Corruptions aka the number of heads in our 10 to the fourth coin flips and that's fine it is a binomial the dynomial is completely correct but now you have to do you know in the polynomial probability Mass function there's this term and it's going to involve the N choose k k might be reasonable but n might be 10 to the power 4 and this could be a really really unwieldy large number to compute so if we can't just solve problems with the binomial directly what could we do Play Ultimate Frisbee go have a good day no we can approximate we can approximate this with a poisson and why can we approximate this kind of looks like our thought experiment from the beginning of class where we took time and we broke it into 10 000 milliseconds those 10 000 milliseconds were n approaching infinity and 10 to the fourth is clearly not Infinity but you're getting closer to Infinity so we could set up a poisson that looks like this binomial it's so backwards because the video class we're like setting up a um we're setting of the binomial to look like a poisson and we're now we're doing the poisson to look like a binomial but so it goes that is just the full circle of life so I'm going to call these extreme nnp and they arrive in many cases uh and you know there's a few examples for people who are early days of the internet were often trying to figure out what to do about server crashes and a lot of it had to do with being able to think about this probability problem so let's revisit this problem and let's say we couldn't solve any pmf for that binomial so what we're going to do is we're going to come up with an approximating poisson this is not a poisson process but since that n was so close to infinity and it was a binomial getting closer to Infinity it's going to look like a poisson but which poisson does it look like we have to choose a rate and before you know how we chose P to be equal to Lambda over n now we have to choose a Lambda and if you want to choose a Lambda you could use this same equation you can say I want the Lambda that's equal to n times p if you think about it n times P should give you your expected number of occurrences and in this case if you multiply those two numbers it's 0.01 now we can we can say what's the probability of K Corruptions for example you can put in what's the probability of zero Corruptions and you're like wait but that leaves you with a zero factorial oh my gosh you're going to be divided by zero there's gonna be a sad time run away I don't know who did this is it just a definition but there's a beautiful thing about the world zero factorial is not zero it's one what a time to be alive so this is actually a really good place to be because this is just equal to e to the power of negative Lambda and we just Define Lambda to be equal to 0.01 so this is just e to the power of zero point negative 0.01 and saying the chance of zero Corruptions uh is actually 0.99 so if you had this corruption rate you could say oh I feel rather confident that I probably won't get a single corruption and this could be a reasonable way to store data crazy thing to do now I need to give you guys some guard rails because with such great powerful or wait such great power comes such great responsibility right you need to know when you can use this approximation you have to do it when n times p is moderate so I'm going to Define moderate to be any of the thing that satisfies these two rules um and it's supposed to be useful when n goes to Infinity but you know 100 turns out to be close enough Infinity for this to work pretty well let me just show you what I mean by that here's a binomial with n is 10 and P is 0.3 that's the Red Bar the green bar is certainly not Infinity it's n a hundred it's 150 no but both of these are approaching a poisson of three because if you took your n times P you would get a three and look how similar that poisson is to both of these binomials even when n is very far from an infinity when you get this value of n being much larger than P you have very small P you have kind of moderately large n the poisson actually looks like a really good approximation now for these small numbers you can do the binomial exactly but this is just to show you that you know if your n is probably higher than 100 and your p is a small number certainly you're going to get an incredible approximation with a plus sign again what are our learning goals here it's a new trick it's a tool you can use it and also it's to help reinforce this connection between the binomial and the poisson because that's just a beautiful thing okay and then we have a new major key poisson you can use it to proximate binomial when n is large and P is small ah now it's time for some tender moments with the poisson as you recall uh moments is the really fancy term for expectation and variance the expectation is called the first moment and the variances the second Central moment yes why do we need the assumption that MP is moderate uh good question I think it really is one way of expressing that you want P to be small and N to be large and I guess yeah if n was large so like what if n was large and P was large I think if n is large and P is large it actually does lead to some weirdness where it doesn't actually work out so um so oh well if Lambda is if Lambda is a moderate number and if that if we're defining it then you're fine so we defined Lambda to be uh we got this P when we were approximating the poisson with a binomial but now we're approximating the binomial poisson somebody could throw a binomial at you where the Lambda is not reasonable where it's a very different number okay someone asked the wonderful question what about variance like what if your events have high variance like what's going on with the variance of this poisson and does it ever start to break and I have such a beautiful piece of information to share with you recall for the binomial we have the expectation of a binomial and that's just n times P of so if somebody gives you a binomial and they say give me the expectation you just have to multiply those two parameters together if somebody gives you a binomial and they ask for the variance you multiply your two parameters together and then you multiply it times 1 times p and then you give them back the variance we have to think about what expectation and variance should be for a poisson so let's imagine we have our Lambda and Lambda really comes from an N times P where n is going to infinity and P is going to zero are you guys ready for this is beautiful Lambda is our one parameter and the expectation of our random variable you know it because it's a binomial and the expectation of binomial is n times p in the limit this n times p is just how we derive Define Lambda so in the limit the expectation is just your rate and you're like wait no that actually just kind of makes sense you told me that the average number of events per time frame was Lambda and now you're telling me that the average number of events per time period is Lambda that's actually just kind of circular like okay okay that's just fine but wait for this one what's the variance of this random variable well here's the variance of your binomial and of course the poisson approximates the binomial or is the binomial in the limit n times P that's how we Define Lambda and what about when p goes to zero as n goes to Infinity what's 1 minus P that's just one and you're like the variance is also Lambda everything about this poisson Lambda the expectation Lambda the variance is Lambda and you're like what if your number of events is a hundred per time frame variance is a hundred if it's a thousand variance is a thousand it's always given to you you give me the rate and I can tell you the variance in fact that variance is equal to exactly the rate uh what a gorgeous beautiful world we live in so yes I have such great news for you expectation and variance of poisson are in fact the same and they're in fact Lambda yes dysfunction for like all croissants or is this just specifically what Hassan's being used sorry this is this is back to the general poisson so even if you're just using a natural poisson these are your expectation and variance Wild somebody's like I just can't believe it this is just so mind-bending okay brings a tear to my eye okay this is a random aside this is a real license plate that I saw at Stanford uh poisson a three and I imagine it's just somebody who like realized that for with the rate of three they actually had a Plus on and it brought a tear to their eye and then they got a vanity plate and I wish I had that many plate but I don't that's not important right now okay um now the only thing that's giving us angst is it feels like there was a lot of assumptions that must be made for the poisson to occur we said like you know as long as a process occurs with a relatively fixed rate you'll get poisson and I have good news let's say you make that assumption about that what we call the poisson process assumption that your rate's not changing and now the occurrence of one event is not changing the probability of another event occurring even if you start to um uh break those assumptions the poisson still ends up being incredibly good and so there's this whole idea of the poisson Paranormal and you just think of poisson being like the most chill random variable you're like I've got a rate and then somebody's like well is it a poisson process is my is your Lambda constant over time you're like kinda and you're like well does it fit the coin flip metaphor where like one coin Flip's not really changing the chance of another one you're like kind of but you know like maybe somebody requested and they tell their friend and then their friend request it because they're going the same place and poisson's chill they're like yeah you've kind of violated my assumptions but you know what I'm still gonna give you a great probability anyways so you can still apply a poisson approximation when uh successes are not entirely independent like coin flips in a binomial and um when the there's a small variation in the probability of success over your time frame it's just that amazing okay let's do a couple examples before we jump into thinking about something more interesting um like the probability of extreme weather okay this is one for you guys to do I've been talking a lot about poisson you guys know it's a cool thing now but do you have the power of the poisson yourselves so this is what a croissant problem could look like see if you can figure it I'm going to give you guys two minutes to think about it think about it first for a little bit but please please do make a friend and talk to the person next to you okay ah fantastic nothing in this problem says Plaza explicitly but this problem screams poisson now that we are educated people so the reason that this screams plus saw is a few reasons we're talking about the number of events happening within a time period so we're saying number of hits to a server within one second apply to one second absolutely you can apply to a year it can apply to a second apply to a minute you know you could take a second and break into infinitely many uh subsections just like you could do a minute so for this reason the poisson seems like it'll be a great uh great thing to use in this case the only thing you'd need if you wanted to use a poissons you need to know the average number of events per time frame and huzzah here it is in the past server load averages two hits per second and as we now know as soon as somebody gives you a narrative that fits the poisson and they give you a rate you immediately inherit expectation and variance and the full probability Mass function which means you could ask questions like what's the probability that x equals zero now of course the one interesting thing here is this isn't asking the probability that x equals zero it's asking if it probably X is less than five and now you think about it Chris never told you how you can take a poisson and answer probably like the question like the probably the x is less than five I only give you an equation phrase saying the probability that X takes on a specific value k but some engineering student is like oh I know what to do we're just going to take our good friend the for Loop in mathematics which looks like this and we're going to for loop from I equals zero up until four inclusive and we're going to add up the probability that x equals I so this is a very fancy way of saying take the problem x equals zero add it to the probably that x equals one adds to probably x equals two three four and then you're done since they're all mutually exclusive probabilities we can just add them up you can only do addition when your events are mutually exclusive but assignments to a random variable are mutually exclusive events so my solution would look like this I Define and declare to all who will listen acts as a poisson and I have to give the parameter which is two then I say exactly this the probably the x is less than five is the sum of all of these probably Mass functions and then I could just plug in this beautiful equation we derived earlier for the probably Mass function of a poisson if x was not a poisson obviously I wouldn't be able to use this probably Mass function since it is I get all this math for free I didn't have to derive the probability of a binomial in the limit and then you could just plug this into a calculator and if you get that this gives you a 95 problem 90 probability of 95 that you'll get less than five hits uh within a second okay questions [Music] so one thing that's pretty important is like when you're choosing your values okay and left on the third within the same time frame right okay it happened every two seconds and 11 differently like five seconds it wouldn't really work so I wanted to work that through yeah you have to adjust though but my question is I think we're the same time for example so if it was more hits every two seconds then with the probability that X is less than 10 would be the same well we'll call the K is your query so what what's your query and it has to be an integer what was your query oh you want to say like K is now you were talking about you want what's four hits within two seconds right yeah okay and now you have a rate that's provided within one second I could solve this using X or let's let's call it y as my poisson and now my y will be the number of events not in one second but in two seconds and in that case what should be my rate for a number of events within two seconds to do four yeah uh and then you could say what's the probability that you know um why equals four and if you worked out the probably that y equals four uh I believe it will be equivalent to if you did the probably that X took on the value too no those are slightly because four hits within two seconds it's a similar but slightly different question than two hits within one second yeah so there will be slightly different numbers yeah okay but interesting interesting thought experiment yeah you can do all those things you can ask about questions slightly outside the time frame you just have to adjust your rate to make it work can I just tell you some cool stuff so at this point I want you guys to be thinking where does this show up in my life because I don't run Uber pool uh like will I actually see this I'd say poisson is one of those things that people should know about but don't know about which means that there's all these math algorithms out there waiting for somebody just recognize that they're poisson and I will give you two examples once from my own life uh and ones from a colleague's life cauliflife is certainly more interesting than mine but my my experience was I went to a doctor and they're trying to measure they're trying to track inflammation that I had over time so I went to the doctor one day and their accounting number of cells and they got four and then I they came in you know I came in a few weeks later and they counted number of cells and they said I have five and they said your inflammation's gotten worse and immediately I was like oh because of the same way that you can drive a croissant over time you can do it over space I'll have you guys do this in a section problem I was like oh as soon as you tell me um that my number of inflammation cells is four using some math I'll learn we'll learn later in class I could infer distribution over rates and then I can tell I was like okay the probability that I've gotten worse is only like 0.56 and I could know exactly that just because of my knowledge of poisson and of course it's not so useful for me in that one case but then the doctor learns you know there was this like oh wait we've been measuring inflammation this whole time we didn't know that because this process is poissonian we can tell people you know usable probabilities addition so anyway small thing in my life maybe the more interesting thing in my colleague's life is do you guys know Google has this photo app that lets you take photos when it's really really dark Has anyone used that photo app okay you can be like basically pitch deck pitch black you can put a sheet of piano music you can take a photo and you can read that piano music and I don't know if you guys use old school digital cameras but that absolutely wasn't possible and the reason that we were able to do this very magical thing of taking photos in incredible dark is because somebody realized that the way that photons were hitting camera was coming in as a poisson process and because of that they could take lots of photos and they could remunerate some of the uncertainty in the poisson and end up with really high resolution photos and it's just like oh yeah this incredible natural phenomena leads to all these small magical things in the world now none of these things have really changed the world but it's just gorgeous how there's these small little ways that we can use math to do something tiny and magical in our worlds so anyways the poisson I think it's kind of a cool thing that was such a random side okay I am going to give us our two minute pedagogical pause before we talk about probability for extreme weather so take two minutes uh go the bathroom break if you need to and we'll continue this conversation okay okay and we're gonna just we're going to get some real data we're gonna look at some some real stuff here um I I've downloaded a whole bunch of hurricane data and we're going to think about probability of extreme weather um but before we do that any questions this is our chance to have a nice little conversation about our good friend poisson hopefully during that that two minute break you had a moment to crystallize what we've done like that derivation we did at the beginning is kind of a big deal because I want you to know that Narrative of where the poisson comes from so like just knowing that beautiful derivation is a cool thing then knowing a poisson being able to recognize it and use it that's also a cool thing and then we have these two nicest sides one was the expectation the variance of poisson and then we also talked about the poisson approximating a binomial so those two nicest sides and then of course the most important thing is that you just get some practice with poissons and that's what we're going to do next so the US has been paying attention to hurricanes for a long time and they've been recording it since 1851 and this is a histogram that I made and I just made it off the public data that the US Reports on hurricanes within the Atlantic so every year here is just a histogram saying that like in this year this is the number of hurricanes and and if you look at it over time you kind of get this feeling that there's more hurricanes now than there used to be and I was just wondering can we just dive into that and see if we can tell that story a little bit more formally than just like hey check out my cool graph it goes that way so what I'd like to do is let's actually go to the code and let's use our computer science skills uh and our understanding of poisson now to to try and understand this so here's the data that I've got for us it's the heard that data that's what they call this database of hurricanes and every single row here is a hurricane it tells you things like where the hurricane was uh if it had a name and it also tells you like the strength of the hurricane so a lot of information and importantly it also has when the hurricane took place so I have some code for us to use the first thing I had to do is we're talking about number of hurricanes within one year that seems to be the random variable that I'm curious about I have every reason to believe it's poissonian you know well actually the assumption that the number of hurricanes is consistent throughout your time period is violated but it you know how we talked about how the poisson still works when you violate the assumptions mildly it turns out hurricanes still look very very poissonian even though they're a bit seasonal so even though hurricanes are seasonal if you think about number of hurricanes within a year that distribution historically looks very poissonian so I believe it's quasanian I have data and I just need to extract a single number from that data what I need from the data is I need to know the rate I need to know the average number of hurricanes in one year and once I know that rate that's all I need to understand the full distribution for probabilities within a time frame which means that this code is actually pretty straightforward um so my code is going to load all the data and then basically I'm going to Loop over every year I'm going to sum up how many hurricanes took place in my range of years and then my rate is very simply wait for it number of hurricanes I counted divided by the number of years in my range and that's the only piece of information I needed as soon as I have this rate I can declare I think I have a poisson and I'm going to say here's my years here's my rate I'm going to say X's number of hurricanes a year I'm going to declare it to be a poisson with this particular rate and then what I have here is I'm going to just really quickly show you how you can use a poisson in Python the stats package has a poisson and that poisson module has a probably Mass function so you can say I have a poisson with this rate call it X and then you can say x dot pmf and you can put in zero and it'll give you a probability that this poisson takes on the value of zero you have pmf1 you get the probability that it takes on One in fact to kind of illuminate this I'm going to loop from 0 to 40. I'm going to say what's the probability of X is zero what's the problem that X is one should we take a look this isn't exactly solving uh my problem but it's just exploring this data um python explore hurricanes okay so I'm looking at hurricanes I looked in 115 years in fact I was looking at the years 1851 to 1966. that's 115 years over those 115 years we saw 975 hurricanes that leaves a rate of 8.5 hurricanes and as soon as I see this because I think the process seems plus onion I'm going to say the number of hurricanes in a year that random variable is going to be a poisson with Lambda equal to the rate I calculated as soon as you do this you inherit the probability Mass function this is just one way of expressing it I'm going to say this is zero hurricanes and this is the chance to gain zero hurricanes here's one hurricane chance getting one hurricane two hurricanes chance of getting two hurricanes based on this rate I got from historical data okay which means I can start to answer questions but the first thing maybe we should look into before we get into a more philosophical questions is was poisson a good approximation so I looked at my historical data I pulled out Lambda of 8.5 that Lambda of 8.5 gives me this blue distribution for the probability of zero one two three so on hurricanes per year let's just compare that to the histogram of hurricanes per year how many times did we see 10 hurricanes well that's the Orange Line how many times we see 20 hurricanes because there's only 115 samples you wouldn't expect this to be a perfect match but that's a pretty good match that's what it looks like when natural phenomena follows a poisson like you could have predicted that shape pretty well just by knowing the average even though hurricanes mildly violate the Assumption of the poisson it's close enough that we really get a good Insight from a single number but that's not really my question my question wasn't uh what's the the distribution of hurricanes I want to know is the distribution changing so what I did is we calculated this rate up to 1966. now let's take this poisson and see how well does it predict the number of hurricanes in a year after 1966. so I looked at that data and I noticed that there is a couple years when you start to see more than 15 hurricanes in a year and the poisson says that's pretty unlikely I want to show what it could look like to make an argument that like oh it looks like the distribution has changed or what we would call shifted what's the probability of having a year with 15 hurricanes so if there's a year with 15 hurricanes I'm going to say that's pretty improbable based on this plus song but can I quantify that if x is the number of hurricanes a year and X is a poisson 8.5 what's the probability of getting more than 15 hurricanes and let's do this in the code I want to use this code and figure out what's the probability of more than 15 or is it yeah more than 15 hurricanes oh this says more than 15 hurricanes so I have X it's a poisson I can ask it's probability Mass function that's the API you have access to can we use our code to calculate exactly the probability of getting 15 or more hurricanes in a year now what we really should do is we should sum over all those values that satisfy greater than 15. so here's what I'm planning to do I'm going to write a for Loop and that for Loop is going to run from I equals 16 because we're not including a 0 up to 15 up to Infinity I'm going to add the probability that x equals I why is this a bad idea well it is correct this technically is the probability of getting 16 or more hurricanes it's probably getting 16 hurricanes plus probably getting 17 plus the probability of getting 18. it's correct but why is this not going to be a fun thing to code up let's just try we'll do like four uh in range uh 16 to is it like math.infinity yeah my computer's gonna get tired uh-oh wait do we not have the ability to ask the question what's the probability that um X is greater than 15. ah somebody knows yes you can take the complement of from the spirit of 15. probably X is less than 15 is 1 minus the probability sorry that's greater than 15 is one minus probably the x is less than or equal to 15. uh and that is much easier to calculate probably that X is less than or equal to 15 just means I have to loop from 0 up to 16 which is man range is such a funny thing in Python okay so here I get I but I don't want I I want the probability that x equals I in math we call that the probability Mass function and in Python if I want to look at the probably math function of I for this poisson random variable X I just do x dot pmf I'm going to do probability starting at zero I'm simply going to add up each of these probably Mass functions you know I'm going to be doing the sum from 1 to 15. now I'm not supposed to report that number I'm supposed to report 1 minus that probability so I'm going to calculate this is the probability of 0 to 15 hurricanes and I want 1 minus that probably that's probably more than 15. so let's run this it says the chance of getting more than 15 hurricanes is about 1.3 percent okay so if I go back here I'm like well they're these two years with more than 15 hurricanes maybe that's believable it seems unlikely but within the realm of possibility what looks less like it's in the realm of possibilities since 1966 there have been two years with more than 30 hurricanes and can we calculate the probably of more than 30 hurricanes absolutely we just do the exact same thing it's just now instead of looping from 0 to 15 we're going to Loop to 30. and the probability of having a year with more than 30 hurricanes assuming the distribution that we modeled going up to 1966 is 1 minus 0.99999999999 and then a bunch of nines and then seven it's incredibly unlikely the number of hurricanes that we've seen and in fact um if I plot the data after 1966 it no longer looks like it's coming from this poisson in fact it looks like it's coming from a poisson but a different looking poisson a poisson with a much higher rate and so this is a pretty good argument that the rate of recorded hurricanes up till 1966 looks very different from the rate of recorded hurricanes afterwards now there's a lot of stories that we're talking about certainly one of the first things that should come to mind is this incredible change that has happened to our Earth there is a lot more CO2 in the world that means that there's a lot more heat in the atmosphere which means a lot more energy for Hurricane so certainly this is a hypothesis for why we think there could be a distribution shift it turns out this has led to more extreme hurricanes but it turns out this is not the exact answer for why there is such a big distributionship in number of hurricanes so more energy in the atmosphere means that when we have hurricanes they tend to be bigger but it doesn't necessarily mean more uh hurricanes so I want to have another hypothesis which you guys want to know okay here's what happened in 1966 they started using um they started using satellites to track hurricanes and so before 1966 you would only catch a hurricane if somebody reported the hurricane and after 1966 we would catch any hurricane that ever existed so was there distribution ship in recorded hurricanes absolutely because we got a lot better at recording hurricanes so it looked like there's many more hurricanes per year so there's more extreme hurricanes because of climate change but that distribution shift turns out it came from satellites anyways there you go um here I put all the python things you might want to know they're in the slides come back next time and we're going to continue this wonderful story thank you guys so much have a wonderful rest every week come back on Friday and we will learn more cool things okay have a good one